{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://forwardnetworks.github.io/schema/integration.schema.json",
  "title": "Forward Integration Entry",
  "type": "object",
  "required": [
    "id",
    "name",
    "summary",
    "repo_url",
    "docs_url",
    "category",
    "integration_targets",
    "maturity",
    "support_tier",
    "maintainers",
    "maintainer_source",
    "verified_by",
    "issue_url",
    "license",
    "last_release_date",
    "last_repo_commit_date",
    "last_verified_date",
    "compatibility",
    "security_notes"
  ],
  "properties": {
    "id": { "type": "string", "pattern": "^[a-z0-9-]+$" },
    "name": { "type": "string", "minLength": 1 },
    "summary": { "type": "string", "minLength": 1, "maxLength": 200 },
    "repo_url": { "type": "string", "format": "uri" },
    "docs_url": { "type": "string", "format": "uri" },
    "category": {
      "type": "string",
      "enum": ["source-of-truth", "automation", "cloud-sync", "reporting", "other"]
    },
    "integration_targets": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string", "minLength": 1 }
    },
    "maturity": { "type": "string", "enum": ["incubating", "active", "deprecated"] },
    "support_tier": { "type": "string", "enum": ["best_effort"] },
    "maintainers": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string", "pattern": "^@[A-Za-z0-9_.-]+(/[A-Za-z0-9_.-]+)?$" }
    },
    "maintainer_source": { "type": "string", "enum": ["manual", "derived_recent_contributors"] },
    "maintainer_last_derived_date": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
    "verified_by": { "type": "string", "pattern": "^@[A-Za-z0-9_.-]+(/[A-Za-z0-9_.-]+)?$" },
    "issue_url": { "type": "string", "format": "uri" },
    "license": { "type": "string", "minLength": 1 },
    "last_release_date": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
    "last_repo_commit_date": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
    "last_verified_date": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
    "compatibility": {
      "type": "object",
      "required": ["forward_min_version", "tested_environments"],
      "properties": {
        "forward_min_version": { "type": "string", "minLength": 1 },
        "tested_environments": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 1 }
        }
      },
      "additionalProperties": false
    },
    "security_notes": { "type": "string", "minLength": 1 },
    "fork": {
      "type": "object",
      "required": ["upstream_repo", "upstream_branch", "fork_branch", "note"],
      "properties": {
        "upstream_repo": { "type": "string", "pattern": "^[A-Za-z0-9_.-]+/[A-Za-z0-9_.-]+$" },
        "upstream_branch": { "type": "string", "minLength": 1 },
        "fork_branch": { "type": "string", "minLength": 1 },
        "note": { "type": "string", "minLength": 1 }
      },
      "additionalProperties": false
    },
    "deprecation": {
      "type": "object",
      "required": ["status", "date", "replacement"],
      "properties": {
        "status": { "type": "string" },
        "date": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
        "replacement": { "type": "string" }
      },
      "additionalProperties": false
    }
  },
  "allOf": [
    {
      "if": {
        "properties": { "maintainer_source": { "const": "derived_recent_contributors" } },
        "required": ["maintainer_source"]
      },
      "then": {
        "required": ["maintainer_last_derived_date"]
      }
    }
  ],
  "additionalProperties": false
}
